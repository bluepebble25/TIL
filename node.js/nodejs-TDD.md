# Node.js TDD (Mocha + Should + SuperTest ì¡°í•©)

- [TDDë€?](#tddë€)
- [Mocha](#mocha)
- [Should](#should)
- [SuperTest](#supertest)

## TDDë€?
í…ŒìŠ¤íŠ¸ ì£¼ë„ ê°œë°œ(Test-Driven-Development)ì˜ ì•½ìì´ë‹¤.
- ì„¤ê³„ -> ì½”ë“œ ê°œë°œ -> í…ŒìŠ¤íŠ¸ ğŸ™…â€â™€ï¸
- ì„¤ê³„ -> í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± -> ì½”ë“œ ê°œë°œ ğŸ™†â€â™€ï¸

ì±…ì„ ì“¸ ë•Œ ëª©ì°¨ë¶€í„° ì“°ê³  ì„¸ë¶€ ë‚´ìš©ì„ ì±„ì›Œê°€ëŠ” ê²ƒì²˜ëŸ¼, ë¨¼ì € ì‘ì€ ë‹¨ìœ„ì˜ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì‘ì„±í•˜ê³  ê·¸ ê²ƒì„ í†µê³¼í•˜ëŠ” ì½”ë“œë¥¼ ë§Œë“œëŠ” ê²ƒì„ ë°˜ë³µí•œë‹¤.

ì´ ê¸€ì—ì„œëŠ” ë‹¨ìœ„ í…ŒìŠ¤íŠ¸, í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ì„¸ ê°€ì§€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•´ í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³¼ ê²ƒì´ë‹¤.

ê° ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì—­í• ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.
- Mocha - í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ëŒë ¤ì£¼ëŠ” í…ŒìŠ¤íŠ¸ ëŸ¬ë„ˆ.
- Should - ê°’ ê²€ì¦ì„ ìœ„í•œ ì¨ë“œíŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ, ë…¸ë“œì˜ ê¸°ë³¸ ëª¨ë“ˆì¸ assertì™€ ê°™ì€ ê¸°ëŠ¥ì„ í•œë‹¤. ê°€ë…ì„±ì„ ìœ„í•´ assert ëŒ€ì‹  ì‚¬ìš©ëœë‹¤.
- SuperTest - í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬. í†µí•© í…ŒìŠ¤íŠ¸ë€ APIì˜ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸ í•˜ëŠ” ê²ƒìœ¼ë¡œ, ì—¬ê¸°ì„œëŠ” SuperTestê°€ ìµìŠ¤í”„ë ˆìŠ¤ ì„œë²„ë¥¼ êµ¬ë™í•´ ìš”ì²­ì„ ë³´ë‚´ê³  ê²°ê³¼ë¥¼ ê²€ì¦í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì´ë¤„ì§„ë‹¤.

## Mocha
### 1. ì„¤ì¹˜
- ê°œë°œ ì˜ì¡´ì„± ëª¨ë“ˆë¡œ ì¶”ê°€í•˜ê¸° (node_modulesì— ì„¤ì¹˜ë˜ë©° `package.json`ì˜ `devDependencies`ì— ì¶”ê°€ë¨)
  ```
  npm install mocha --save-dev
  ```
- ì „ì—­ìœ¼ë¡œ ì„¤ì¹˜í•˜ê¸°
  ```
  npm install mocha -g
  ```
### 2. í…ŒìŠ¤íŠ¸ ì½”ë“œ íŒŒì¼ ë§Œë“¤ê¸°
ì˜ˆë¥¼ ë“¤ì–´ `calculator.js`ë¥¼ í…ŒìŠ¤íŠ¸í•œë‹¤ê³  í•˜ë©´ ê·¸ê²ƒì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” `calculator.spec.js`ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë§Œë“ ë‹¤.

### 3. í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±
- í…ŒìŠ¤íŠ¸ ìŠˆíŠ¸(test suite)
  - í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë“¤ì´ ëª¨ì—¬ì„œ í•˜ë‚˜ì˜ í…ŒìŠ¤íŠ¸ ìŠˆíŠ¸ë¥¼ ì´ë£¬ë‹¤.
  - mochaì—ì„œëŠ” `describe()`ì— í•´ë‹¹
- í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤(test case)
  - ê°€ì¥ ì‘ì€ í…ŒìŠ¤íŠ¸ì˜ ë‹¨ìœ„
  - mochaì—ì„œëŠ” `it()`ì— í•´ë‹¹

```js
// index.spec.js
const pow = require('./index');
const assert = require('assert');

describe('pow í•¨ìˆ˜ëŠ”', () => {
  it('ì£¼ì–´ì§„ ìˆ«ìì˜ n ì œê³±ì„ ë°˜í™˜í•œë‹¤.', () => {
    assert.equal(pow(2, 3), 8);
  });
  it('3ì„ 4ë²ˆ ê³±í•˜ë©´ 81ì´ë‹¤.', () => {
    assert.equal(pow(3, 4), 81);
  });
  it('5ë¥¼ 3ë²ˆ ê³±í•˜ë©´ 125ì´ë‹¤.', () => {
    assert.equal(pow(5, 3), 125);
  });
});
```

```js
// index.js
module.exports = function (a, b) {
  return Math.pow(a, b);
};
```

ì—¬ê¸°ì„œëŠ” pow í•¨ìˆ˜ë¼ëŠ” ê°„ë‹¨í•œ ì˜ˆì‹œë¥¼ ë“¤ì—ˆê¸° ë•Œë¬¸ì— it()ì„ ì—¬ëŸ¬ ê°œ ì‚¬ìš©í•˜ë ¤ëŠ” ì˜ˆì‹œë¥¼ ìœ„í•´ ì €ë ‡ê²Œ ì¼ì§€ë§Œ, ë³´í†µì€ ì–´ë–¤ í•¨ìˆ˜ê°€ í•˜ëŠ” í–‰ìœ„ë¥¼ ì˜ê²Œ ìª¼ê°œê±°ë‚˜ ë°œìƒí•˜ëŠ” ì—¬ëŸ¬ ê²½ìš°ì˜ ìˆ˜ë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì‘ì„±í•œë‹¤.

ì˜ˆë¥¼ ë“¤ë©´, json ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ ê·¸ ì¤‘ í•œ í•„ë“œì˜ ê°’ì„ êµ¬í•˜ëŠ” í•¨ìˆ˜ë¥¼ í…ŒìŠ¤íŠ¸ í•œë‹¤ë©´, describeì—ëŠ” ê·¸ í•¨ìˆ˜ì˜ ì´ë¦„ì„ ì“°ê³ , itì—ëŠ” ê°ê° ë¹„ë™ê¸°ë¡œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” í–‰ìœ„ë¥¼ ì„±ê³µí•˜ëŠ”ì§€, ë°›ì€ ë°ì´í„°ê°€ json í˜•ì‹ì¸ì§€, íŠ¹ì • í•„ë“œì˜ ê°’ì„ êµ¬í•  ë•Œ ê²°ê³¼ê°€ ì˜¬ë°”ë¥¸ì§€ ì²˜ëŸ¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

### 4. ì‹¤í–‰ë°©ë²•
- ìœˆë„ìš°
  ```
  node ./node_modules/mocha/bin/mocha index.spec.js
  ```
- ë¦¬ëˆ…ìŠ¤
  ```
  node_modules/.bin/mocha index.spec.js
  ```

ê²°ê³¼
> pow í•¨ìˆ˜ëŠ”  
âˆš ì£¼ì–´ì§„ ìˆ«ìì˜ n ì œê³±ì„ ë°˜í™˜í•œë‹¤.  
âˆš 3ì„ 4ë²ˆ ê³±í•˜ë©´ 81ì´ë‹¤.  
âˆš 5ë¥¼ 3ë²ˆ ê³±í•˜ë©´ 125ì´ë‹¤.  
3 passing (9ms)

## Should
ë…¸ë“œ ëª¨ë“ˆì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•˜ëŠ” assert ëª¨ë“ˆì„ í™•ì¥í•œ ì¨ë“œíŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤. `A.should.be.equal(B)`, `A.should.not.be.equal(B)` ì²˜ëŸ¼ ë³´ë‹¤ ê°€ë…ì„±ìˆê²Œ ê°’ì„ ê²€ì¦í•  ìˆ˜ ìˆë‹¤.

### 1. ì„¤ì¹˜
```
npm install should --save-dev
```

### 2. ì‚¬ìš© ì˜ˆ
```js
// utils.spec.js
const utils = require('./utils');
const should = require('should');

describe('utils ëª¨ë“ˆì˜ capitalize í•¨ìˆ˜ëŠ”', () => {
  it('ë¬¸ìì—´ì˜ ì²«ë²ˆì§¸ ë¬¸ìë¥¼ ëŒ€ë¬¸ìí™”í•œë‹¤.', () => {
    const result = utils.capitalize('Hello');
    result.should.be.equal('Hello');
  });
});
```

```js
// utils
function capitalize(str) {
  return str.charAt(0).toUpperCase() + str.slice(1);
}

module.exports = {
  capitalize: capitalize
};
```

ì—¬ê¸°ì„œëŠ” ê°„ë‹¨í•œ ì‚¬ìš© ì˜ˆì‹œë§Œ. ìì„¸í•œ í•¨ìˆ˜ëŠ” ê²€ìƒ‰ìœ¼ë¡œ ì•Œì•„ë³´ê¸°

## SuperTest
```js
// index.js
const express = require('express');
const app = express();

const users = [
  {id: 1, name: 'James'},
  {id: 2, name: 'Amelia'},
  {id: 3, name: 'Luna'}
];

app.get('/users', (req, res) => {
  res.json(users);
});

app.listen(3000, () => {
  console.log('Server is running on port 3000');
});

module.exports = app;
```

```js
// index.spec.js
const app = require('./index');
const request = require('supertest');

describe('GET /usersëŠ”', () => {
  it('json ë°°ì—´ì„ ë°˜í™˜ë°›ëŠ”ë‹¤.', (done) => {
    request(app)
        .get('/users')
        .expect('Content-Type', /json/)
        .expect(200, done);
  });
});
```
mochaë¡œ ì‹¤í–‰í•´ì¤€ë‹¤.

supertestë¥¼ requestë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¤ê³ , `request(app)`ì„ í†µí•´ supertestê°€ express ì„œë²„ë¥¼ ì‹¤í–‰í•˜ë„ë¡ í•œë‹¤. ì²´ì´ë‹ ë©”ì†Œë“œ í˜•ì‹ìœ¼ë¡œ supertestê°€ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ê²Œ ë³´ë‚´ëŠ” ìš”ì²­ê³¼ ê¸°ëŒ€í•˜ëŠ” ê°’ì„ ì‹œë‚˜ë¦¬ì˜¤ì²˜ëŸ¼ ì‘ì„±í•˜ë©´ ëœë‹¤. doneì€ ë¹„ë™ê¸°ì²˜ë¦¬ë¥¼ í•´ì£¼ê¸° ìœ„í•œ ì½œë°±í•¨ìˆ˜ì´ë‹¤.

ë§Œì•½ API í˜¸ì¶œì˜ ê²°ê³¼ê°’ì„ ê²€ì¦í•´ì•¼ í•œë‹¤ë©´ ì—¬ê¸°ì—ë„ ë§ˆì°¬ê°€ì§€ë¡œ Shouldë¥¼ ì“¸ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

ì´ë¡œì¨ Mocha + Should + SuperTestë¥¼ ì´ìš©í•´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì™€ í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì•˜ë‹¤.

## Reference
- http://clipsoft.co.kr/wp/blog/tddtest-driven-development-%EB%B0%A9%EB%B2%95%EB%A1%A0/
- https://hanamon.kr/tdd%EB%9E%80-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%A3%BC%EB%8F%84-%EA%B0%9C%EB%B0%9C/
- https://www.npmjs.com/package/supertest